"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _lodash = require("lodash");

var _protocol = require("../../../lib/protocol");

var _crypto = _interopRequireDefault(require("crypto"));

describe('Protocol', function () {
  describe('ensure protocol consistency', function () {
    it('should not change protocol between patch versions', function () {
      let shasum = _crypto.default.createHash('sha1');

      for (let [url, urlMapping] of _lodash._.toPairs(_protocol.METHOD_MAP)) {
        shasum.update(url);

        for (let [method, methodMapping] of _lodash._.toPairs(urlMapping)) {
          shasum.update(method);

          if (methodMapping.command) {
            shasum.update(methodMapping.command);
          }

          if (methodMapping.payloadParams) {
            let allParams = _lodash._.flatten(methodMapping.payloadParams.required);

            if (methodMapping.payloadParams.optional) {
              allParams = allParams.concat(_lodash._.flatten(methodMapping.payloadParams.optional));
            }

            for (let param of allParams) {
              shasum.update(param);
            }

            if (methodMapping.payloadParams.wrap) {
              shasum.update('skip');
              shasum.update(methodMapping.payloadParams.wrap);
            }
          }
        }
      }

      let hash = shasum.digest('hex').substring(0, 8);
      hash.should.equal('736bf246');
    });
  });
  describe('check route to command name conversion', function () {
    it('should properly lookup correct command name for endpoint with session', function () {
      const cmdName = (0, _protocol.routeToCommandName)('/timeouts', 'POST');
      cmdName.should.equal('timeouts');
    });
    it('should properly lookup correct command name for endpoint with session', function () {
      const cmdName = (0, _protocol.routeToCommandName)('/timeouts/implicit_wait', 'POST');
      cmdName.should.equal('implicitWait');
    });
    it('should properly lookup correct command name for endpoint without session', function () {
      const cmdName = (0, _protocol.routeToCommandName)('/status', 'GET');
      cmdName.should.equal('getStatus');
    });
    it('should properly lookup correct command name for endpoint without leading slash', function () {
      const cmdName = (0, _protocol.routeToCommandName)('status', 'GET');
      cmdName.should.equal('getStatus');
    });
    it('should properly lookup correct command name for fully specified endpoint', function () {
      const cmdName = (0, _protocol.routeToCommandName)('/status', 'GET');
      cmdName.should.equal('getStatus');
    });
    it('should not find command name if incorrect input data has been specified', function () {
      for (let [route, method] of [['/status', 'POST'], ['/xstatus', 'GET'], ['status', 'POST']]) {
        const cmdName = (0, _protocol.routeToCommandName)(route, method);
        chai.should().equal(cmdName, undefined);
      }
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZXNjcmliZSIsIml0Iiwic2hhc3VtIiwiY3J5cHRvIiwiY3JlYXRlSGFzaCIsInVybCIsInVybE1hcHBpbmciLCJfIiwidG9QYWlycyIsIk1FVEhPRF9NQVAiLCJ1cGRhdGUiLCJtZXRob2QiLCJtZXRob2RNYXBwaW5nIiwiY29tbWFuZCIsInBheWxvYWRQYXJhbXMiLCJhbGxQYXJhbXMiLCJmbGF0dGVuIiwicmVxdWlyZWQiLCJvcHRpb25hbCIsImNvbmNhdCIsInBhcmFtIiwid3JhcCIsImhhc2giLCJkaWdlc3QiLCJzdWJzdHJpbmciLCJzaG91bGQiLCJlcXVhbCIsImNtZE5hbWUiLCJyb3V0ZVRvQ29tbWFuZE5hbWUiLCJyb3V0ZSIsImNoYWkiLCJ1bmRlZmluZWQiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi90ZXN0L3VuaXQvcHJvdG9jb2wvcm91dGVzLnNwZWMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gdHJhbnNwaWxlOm1vY2hhXG5cbmltcG9ydCB7X30gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7TUVUSE9EX01BUCwgcm91dGVUb0NvbW1hbmROYW1lfSBmcm9tICcuLi8uLi8uLi9saWIvcHJvdG9jb2wnO1xuaW1wb3J0IGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG5kZXNjcmliZSgnUHJvdG9jb2wnLCBmdW5jdGlvbiAoKSB7XG4gIC8vIFRPRE8gdGVzdCBhZ2FpbnN0IGFuIGV4cGxpY2l0IHByb3RvY29sIHJhdGhlciB0aGFuIGEgaGFzaCBvZiBhIHByZXZpb3VzXG4gIC8vIHByb3RvY29sXG5cbiAgZGVzY3JpYmUoJ2Vuc3VyZSBwcm90b2NvbCBjb25zaXN0ZW5jeScsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIG5vdCBjaGFuZ2UgcHJvdG9jb2wgYmV0d2VlbiBwYXRjaCB2ZXJzaW9ucycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzaGFzdW0gPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMScpO1xuICAgICAgZm9yIChsZXQgW3VybCwgdXJsTWFwcGluZ10gb2YgXy50b1BhaXJzKE1FVEhPRF9NQVApKSB7XG4gICAgICAgIHNoYXN1bS51cGRhdGUodXJsKTtcbiAgICAgICAgZm9yIChsZXQgW21ldGhvZCwgbWV0aG9kTWFwcGluZ10gb2YgXy50b1BhaXJzKHVybE1hcHBpbmcpKSB7XG4gICAgICAgICAgc2hhc3VtLnVwZGF0ZShtZXRob2QpO1xuICAgICAgICAgIGlmIChtZXRob2RNYXBwaW5nLmNvbW1hbmQpIHtcbiAgICAgICAgICAgIHNoYXN1bS51cGRhdGUobWV0aG9kTWFwcGluZy5jb21tYW5kKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1ldGhvZE1hcHBpbmcucGF5bG9hZFBhcmFtcykge1xuICAgICAgICAgICAgbGV0IGFsbFBhcmFtcyA9IF8uZmxhdHRlbihtZXRob2RNYXBwaW5nLnBheWxvYWRQYXJhbXMucmVxdWlyZWQpO1xuICAgICAgICAgICAgaWYgKG1ldGhvZE1hcHBpbmcucGF5bG9hZFBhcmFtcy5vcHRpb25hbCkge1xuICAgICAgICAgICAgICBhbGxQYXJhbXMgPSBhbGxQYXJhbXMuY29uY2F0KF8uZmxhdHRlbihtZXRob2RNYXBwaW5nLnBheWxvYWRQYXJhbXMub3B0aW9uYWwpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAobGV0IHBhcmFtIG9mIGFsbFBhcmFtcykge1xuICAgICAgICAgICAgICBzaGFzdW0udXBkYXRlKHBhcmFtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtZXRob2RNYXBwaW5nLnBheWxvYWRQYXJhbXMud3JhcCkge1xuICAgICAgICAgICAgICBzaGFzdW0udXBkYXRlKCdza2lwJyk7XG4gICAgICAgICAgICAgIHNoYXN1bS51cGRhdGUobWV0aG9kTWFwcGluZy5wYXlsb2FkUGFyYW1zLndyYXApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbGV0IGhhc2ggPSBzaGFzdW0uZGlnZXN0KCdoZXgnKS5zdWJzdHJpbmcoMCwgOCk7XG4gICAgICAvLyBNb2RpZnkgdGhlIGhhc2ggd2hlbmV2ZXIgdGhlIHByb3RvY29sIGhhcyBpbnRlbnRpb25hbGx5IGJlZW4gbW9kaWZpZWQuXG4gICAgICBoYXNoLnNob3VsZC5lcXVhbCgnNzM2YmYyNDYnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NoZWNrIHJvdXRlIHRvIGNvbW1hbmQgbmFtZSBjb252ZXJzaW9uJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcHJvcGVybHkgbG9va3VwIGNvcnJlY3QgY29tbWFuZCBuYW1lIGZvciBlbmRwb2ludCB3aXRoIHNlc3Npb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBjbWROYW1lID0gcm91dGVUb0NvbW1hbmROYW1lKCcvdGltZW91dHMnLCAnUE9TVCcpO1xuICAgICAgY21kTmFtZS5zaG91bGQuZXF1YWwoJ3RpbWVvdXRzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb3Blcmx5IGxvb2t1cCBjb3JyZWN0IGNvbW1hbmQgbmFtZSBmb3IgZW5kcG9pbnQgd2l0aCBzZXNzaW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgY21kTmFtZSA9IHJvdXRlVG9Db21tYW5kTmFtZSgnL3RpbWVvdXRzL2ltcGxpY2l0X3dhaXQnLCAnUE9TVCcpO1xuICAgICAgY21kTmFtZS5zaG91bGQuZXF1YWwoJ2ltcGxpY2l0V2FpdCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm9wZXJseSBsb29rdXAgY29ycmVjdCBjb21tYW5kIG5hbWUgZm9yIGVuZHBvaW50IHdpdGhvdXQgc2Vzc2lvbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGNtZE5hbWUgPSByb3V0ZVRvQ29tbWFuZE5hbWUoJy9zdGF0dXMnLCAnR0VUJyk7XG4gICAgICBjbWROYW1lLnNob3VsZC5lcXVhbCgnZ2V0U3RhdHVzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb3Blcmx5IGxvb2t1cCBjb3JyZWN0IGNvbW1hbmQgbmFtZSBmb3IgZW5kcG9pbnQgd2l0aG91dCBsZWFkaW5nIHNsYXNoJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgY21kTmFtZSA9IHJvdXRlVG9Db21tYW5kTmFtZSgnc3RhdHVzJywgJ0dFVCcpO1xuICAgICAgY21kTmFtZS5zaG91bGQuZXF1YWwoJ2dldFN0YXR1cycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm9wZXJseSBsb29rdXAgY29ycmVjdCBjb21tYW5kIG5hbWUgZm9yIGZ1bGx5IHNwZWNpZmllZCBlbmRwb2ludCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGNtZE5hbWUgPSByb3V0ZVRvQ29tbWFuZE5hbWUoJy9zdGF0dXMnLCAnR0VUJyk7XG4gICAgICBjbWROYW1lLnNob3VsZC5lcXVhbCgnZ2V0U3RhdHVzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBmaW5kIGNvbW1hbmQgbmFtZSBpZiBpbmNvcnJlY3QgaW5wdXQgZGF0YSBoYXMgYmVlbiBzcGVjaWZpZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKGxldCBbcm91dGUsIG1ldGhvZF0gb2YgW1xuICAgICAgICBbJy9zdGF0dXMnLCAnUE9TVCddLFxuICAgICAgICBbJy94c3RhdHVzJywgJ0dFVCddLFxuICAgICAgICBbJ3N0YXR1cycsICdQT1NUJ10sXG4gICAgICBdKSB7XG4gICAgICAgIGNvbnN0IGNtZE5hbWUgPSByb3V0ZVRvQ29tbWFuZE5hbWUocm91dGUsIG1ldGhvZCk7XG4gICAgICAgIGNoYWkuc2hvdWxkKCkuZXF1YWwoY21kTmFtZSwgdW5kZWZpbmVkKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBRUFBLFFBQVEsQ0FBQyxVQUFELEVBQWEsWUFBWTtFQUkvQkEsUUFBUSxDQUFDLDZCQUFELEVBQWdDLFlBQVk7SUFD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