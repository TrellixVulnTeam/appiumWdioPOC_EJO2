"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _support = require("@appium/support");

var _sinon = _interopRequireDefault(require("sinon"));

var _deviceSettings = require("../../../lib/basedriver/device-settings");

var _errors = require("../../../lib/protocol/errors");

const {
  expect
} = chai;
describe('DeviceSettings', function () {
  let sandbox;
  beforeEach(function () {
    sandbox = _sinon.default.createSandbox();
  });
  afterEach(function () {
    sandbox.restore();
  });
  describe('constructor', function () {
    describe('when no parameteres are provided to the constructor', function () {
      it('should not throw', function () {
        expect(() => new _deviceSettings.DeviceSettings()).not.to.throw();
      });
    });
  });
  describe('instance method', function () {
    describe('getSettings()', function () {
      it('should return a clone of the internal settings object', function () {
        const settings = {
          foo: 'bar',
          bar: 'foo'
        };
        const deviceSettings = new _deviceSettings.DeviceSettings(settings);
        expect(deviceSettings.getSettings()).to.eql(settings);
      });
    });
    describe('update()', function () {
      describe('when no parameters are provided', function () {
        it('should reject with an InvalidArgumentError', async function () {
          const deviceSettings = new _deviceSettings.DeviceSettings();
          await expect(deviceSettings.update()).to.be.rejectedWith(_errors.InvalidArgumentError, /with valid JSON/i);
        });
      });
      describe('when a non-plain-object `newSettings` param is provided', function () {
        it('should reject with an InvalidArgumentError', async function () {
          const deviceSettings = new _deviceSettings.DeviceSettings();
          await expect(deviceSettings.update(null)).to.be.rejectedWith(_errors.InvalidArgumentError, /with valid JSON/i);
        });
      });
      describe('when the size of the `newSettings` param exceeds `MAX_SETTINGS_SIZE`', function () {
        beforeEach(function () {
          sandbox.stub(_support.node, 'getObjectSize').returns(_deviceSettings.MAX_SETTINGS_SIZE + 1);
        });
        it('should reject with an InvalidArgumentError', async function () {
          const deviceSettings = new _deviceSettings.DeviceSettings();
          await expect(deviceSettings.update({
            stuff: 'things'
          })).to.be.rejectedWith(_errors.InvalidArgumentError, /object size exceeds/i);
        });
      });
      describe('when the `newSettings` param is valid', function () {
        let onSettingsUpdate;
        beforeEach(function () {
          onSettingsUpdate = sandbox.stub();
        });
        describe('when the new settings do not differ', function () {
          it('should not call the `_onSettingsUpdate` listener', async function () {
            const deviceSettings = new _deviceSettings.DeviceSettings({
              stuff: 'things'
            }, onSettingsUpdate);
            await deviceSettings.update({
              stuff: 'things'
            });
            expect(onSettingsUpdate).not.to.have.been.called;
          });
        });
        describe('when the new settings differ', function () {
          it('should call the `_onSettingsUpdate` listener', async function () {
            const deviceSettings = new _deviceSettings.DeviceSettings({}, onSettingsUpdate);
            await deviceSettings.update({
              stuff: 'things'
            });
            expect(onSettingsUpdate).to.have.been.calledOnceWithExactly('stuff', 'things', undefined);
          });
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHBlY3QiLCJjaGFpIiwiZGVzY3JpYmUiLCJzYW5kYm94IiwiYmVmb3JlRWFjaCIsInNpbm9uIiwiY3JlYXRlU2FuZGJveCIsImFmdGVyRWFjaCIsInJlc3RvcmUiLCJpdCIsIkRldmljZVNldHRpbmdzIiwibm90IiwidG8iLCJ0aHJvdyIsInNldHRpbmdzIiwiZm9vIiwiYmFyIiwiZGV2aWNlU2V0dGluZ3MiLCJnZXRTZXR0aW5ncyIsImVxbCIsInVwZGF0ZSIsImJlIiwicmVqZWN0ZWRXaXRoIiwiSW52YWxpZEFyZ3VtZW50RXJyb3IiLCJzdHViIiwibm9kZSIsInJldHVybnMiLCJNQVhfU0VUVElOR1NfU0laRSIsInN0dWZmIiwib25TZXR0aW5nc1VwZGF0ZSIsImhhdmUiLCJiZWVuIiwiY2FsbGVkIiwiY2FsbGVkT25jZVdpdGhFeGFjdGx5IiwidW5kZWZpbmVkIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdGVzdC91bml0L2Jhc2Vkcml2ZXIvZGV2aWNlLXNldHRpbmdzLnNwZWMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtub2RlfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCB7RGV2aWNlU2V0dGluZ3MsIE1BWF9TRVRUSU5HU19TSVpFfSBmcm9tICcuLi8uLi8uLi9saWIvYmFzZWRyaXZlci9kZXZpY2Utc2V0dGluZ3MnO1xuaW1wb3J0IHtJbnZhbGlkQXJndW1lbnRFcnJvcn0gZnJvbSAnLi4vLi4vLi4vbGliL3Byb3RvY29sL2Vycm9ycyc7XG5cbmNvbnN0IHtleHBlY3R9ID0gY2hhaTtcblxuZGVzY3JpYmUoJ0RldmljZVNldHRpbmdzJywgZnVuY3Rpb24gKCkge1xuICBsZXQgc2FuZGJveDtcblxuICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICBzYW5kYm94ID0gc2lub24uY3JlYXRlU2FuZGJveCgpO1xuICB9KTtcblxuICBhZnRlckVhY2goZnVuY3Rpb24gKCkge1xuICAgIHNhbmRib3gucmVzdG9yZSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29uc3RydWN0b3InLCBmdW5jdGlvbiAoKSB7XG4gICAgZGVzY3JpYmUoJ3doZW4gbm8gcGFyYW1ldGVyZXMgYXJlIHByb3ZpZGVkIHRvIHRoZSBjb25zdHJ1Y3RvcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGl0KCdzaG91bGQgbm90IHRocm93JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBleHBlY3QoKCkgPT4gbmV3IERldmljZVNldHRpbmdzKCkpLm5vdC50by50aHJvdygpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnN0YW5jZSBtZXRob2QnLCBmdW5jdGlvbiAoKSB7XG4gICAgZGVzY3JpYmUoJ2dldFNldHRpbmdzKCknLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBhIGNsb25lIG9mIHRoZSBpbnRlcm5hbCBzZXR0aW5ncyBvYmplY3QnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0ge1xuICAgICAgICAgIGZvbzogJ2JhcicsXG4gICAgICAgICAgYmFyOiAnZm9vJyxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZGV2aWNlU2V0dGluZ3MgPSBuZXcgRGV2aWNlU2V0dGluZ3Moc2V0dGluZ3MpO1xuICAgICAgICBleHBlY3QoZGV2aWNlU2V0dGluZ3MuZ2V0U2V0dGluZ3MoKSkudG8uZXFsKHNldHRpbmdzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3VwZGF0ZSgpJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGVzY3JpYmUoJ3doZW4gbm8gcGFyYW1ldGVycyBhcmUgcHJvdmlkZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHdpdGggYW4gSW52YWxpZEFyZ3VtZW50RXJyb3InLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY29uc3QgZGV2aWNlU2V0dGluZ3MgPSBuZXcgRGV2aWNlU2V0dGluZ3MoKTtcbiAgICAgICAgICBhd2FpdCBleHBlY3QoZGV2aWNlU2V0dGluZ3MudXBkYXRlKCkpLnRvLmJlLnJlamVjdGVkV2l0aChcbiAgICAgICAgICAgIEludmFsaWRBcmd1bWVudEVycm9yLFxuICAgICAgICAgICAgL3dpdGggdmFsaWQgSlNPTi9pXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgZGVzY3JpYmUoJ3doZW4gYSBub24tcGxhaW4tb2JqZWN0IGBuZXdTZXR0aW5nc2AgcGFyYW0gaXMgcHJvdmlkZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHdpdGggYW4gSW52YWxpZEFyZ3VtZW50RXJyb3InLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY29uc3QgZGV2aWNlU2V0dGluZ3MgPSBuZXcgRGV2aWNlU2V0dGluZ3MoKTtcbiAgICAgICAgICBhd2FpdCBleHBlY3QoZGV2aWNlU2V0dGluZ3MudXBkYXRlKG51bGwpKS50by5iZS5yZWplY3RlZFdpdGgoXG4gICAgICAgICAgICBJbnZhbGlkQXJndW1lbnRFcnJvcixcbiAgICAgICAgICAgIC93aXRoIHZhbGlkIEpTT04vaVxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGRlc2NyaWJlKCd3aGVuIHRoZSBzaXplIG9mIHRoZSBgbmV3U2V0dGluZ3NgIHBhcmFtIGV4Y2VlZHMgYE1BWF9TRVRUSU5HU19TSVpFYCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgLy8gdGhpcyBpcyBlYXNpZXIgdGhhbiBzZW5kaW5nIGEgMjFNQiBvYmplY3RcbiAgICAgICAgICBzYW5kYm94LnN0dWIobm9kZSwgJ2dldE9iamVjdFNpemUnKS5yZXR1cm5zKE1BWF9TRVRUSU5HU19TSVpFICsgMSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHdpdGggYW4gSW52YWxpZEFyZ3VtZW50RXJyb3InLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY29uc3QgZGV2aWNlU2V0dGluZ3MgPSBuZXcgRGV2aWNlU2V0dGluZ3MoKTtcbiAgICAgICAgICBhd2FpdCBleHBlY3QoZGV2aWNlU2V0dGluZ3MudXBkYXRlKHtzdHVmZjogJ3RoaW5ncyd9KSkudG8uYmUucmVqZWN0ZWRXaXRoKFxuICAgICAgICAgICAgSW52YWxpZEFyZ3VtZW50RXJyb3IsXG4gICAgICAgICAgICAvb2JqZWN0IHNpemUgZXhjZWVkcy9pXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgZGVzY3JpYmUoJ3doZW4gdGhlIGBuZXdTZXR0aW5nc2AgcGFyYW0gaXMgdmFsaWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBvblNldHRpbmdzVXBkYXRlO1xuXG4gICAgICAgIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgIG9uU2V0dGluZ3NVcGRhdGUgPSBzYW5kYm94LnN0dWIoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3doZW4gdGhlIG5ldyBzZXR0aW5ncyBkbyBub3QgZGlmZmVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGl0KCdzaG91bGQgbm90IGNhbGwgdGhlIGBfb25TZXR0aW5nc1VwZGF0ZWAgbGlzdGVuZXInLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCBkZXZpY2VTZXR0aW5ncyA9IG5ldyBEZXZpY2VTZXR0aW5ncyh7c3R1ZmY6ICd0aGluZ3MnfSwgb25TZXR0aW5nc1VwZGF0ZSk7XG4gICAgICAgICAgICBhd2FpdCBkZXZpY2VTZXR0aW5ncy51cGRhdGUoe3N0dWZmOiAndGhpbmdzJ30pO1xuICAgICAgICAgICAgZXhwZWN0KG9uU2V0dGluZ3NVcGRhdGUpLm5vdC50by5oYXZlLmJlZW4uY2FsbGVkO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgnd2hlbiB0aGUgbmV3IHNldHRpbmdzIGRpZmZlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpdCgnc2hvdWxkIGNhbGwgdGhlIGBfb25TZXR0aW5nc1VwZGF0ZWAgbGlzdGVuZXInLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCBkZXZpY2VTZXR0aW5ncyA9IG5ldyBEZXZpY2VTZXR0aW5ncyh7fSwgb25TZXR0aW5nc1VwZGF0ZSk7XG4gICAgICAgICAgICBhd2FpdCBkZXZpY2VTZXR0aW5ncy51cGRhdGUoe3N0dWZmOiAndGhpbmdzJ30pO1xuICAgICAgICAgICAgZXhwZWN0KG9uU2V0dGluZ3NVcGRhdGUpLnRvLmhhdmUuYmVlbi5jYWxsZWRPbmNlV2l0aEV4YWN0bHkoXG4gICAgICAgICAgICAgICdzdHVmZicsXG4gICAgICAgICAgICAgICd0aGluZ3MnLFxuICAgICAgICAgICAgICB1bmRlZmluZWRcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU07RUFBQ0E7QUFBRCxJQUFXQyxJQUFqQjtBQUVBQyxRQUFRLENBQUMsZ0JBQUQsRUFBbUIsWUFBWTtFQUNyQyxJQUFJQyxPQUFKO0VBRUFDLFVBQVUsQ0FBQyxZQUFZO0lBQ3JCRCxPQUFPLEdBQUdFLGNBQUEsQ0FBTUMsYUFBTixFQUFWO0VBQ0QsQ0FGUyxDQUFWO0VBSUFDLFNBQVMsQ0FBQyxZQUFZO0lBQ3BCSixPQUFPLENBQUNLLE9BQVI7RUFDRCxDQUZRLENBQVQ7RUFJQU4sUUFBUSxDQUFDLGFBQUQsRUFBZ0IsWUFBWTtJQUNsQ0EsUUFBUSxDQUFDLHFEQUFELEVBQXdELFlBQVk7TUFDMUVPLEVBQUUsQ0FBQyxrQkFB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