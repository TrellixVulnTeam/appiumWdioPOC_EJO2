"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _lib = require("../../../lib");

var _helpers = require("../../helpers");

var _lodash = _interopRequireDefault(require("lodash"));

describe('JWProxy', function () {
  let port;
  let createTestURL;
  let testStatusURL;
  let createTestSessionURL;
  let testNewSessionURL;
  const PROXY_HOST = '127.0.0.2';
  const PROXY_PORT = 4723;
  const createProxyURL = (0, _helpers.createAppiumURL)(PROXY_HOST, PROXY_PORT);
  const PROXY_STATUS_URL = createProxyURL('', 'status');

  function createJWProxy(opts = {}) {
    return new _lib.JWProxy({
      server: _helpers.TEST_HOST,
      port,
      ...opts
    });
  }

  before(async function () {
    port = await (0, _helpers.getTestPort)();
    createTestURL = (0, _helpers.createAppiumURL)(_helpers.TEST_HOST, port);
    testStatusURL = createTestURL('', 'status');
    createTestSessionURL = createTestURL(_lodash.default, '');
    testNewSessionURL = createTestURL('', 'session');
  });
  describe('proxying full urls', function () {
    it('should translate host and port', function () {
      let incomingUrl = PROXY_STATUS_URL;
      let j = createJWProxy();
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(testStatusURL);
    });
    it('should translate the scheme', function () {
      let incomingUrl = PROXY_STATUS_URL;
      let j = createJWProxy({
        scheme: 'HTTPS'
      });
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal((0, _helpers.createAppiumURL)(`https://${_helpers.TEST_HOST}`, port, '', 'status'));
    });
    it('should translate the base', function () {
      let incomingUrl = PROXY_STATUS_URL;
      let j = createJWProxy({
        base: ''
      });
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(testStatusURL);
    });
    it('should translate the session id', function () {
      let incomingUrl = createProxyURL('foobar', 'element');
      let j = createJWProxy({
        sessionId: 'barbaz'
      });
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(createTestURL('barbaz', 'element'));
    });
    it('should error when translating session commands without session id', function () {
      let incomingUrl = createProxyURL('foobar', 'element');
      let j = createJWProxy();
      (() => {
        j.getUrlForProxy(incomingUrl);
      }).should.throw('session id');
    });
  });
  describe('proxying partial urls', function () {
    it('should proxy /status', function () {
      let incomingUrl = '/status';
      let j = createJWProxy();
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(testStatusURL);
    });
    it('should proxy /session', function () {
      let incomingUrl = '/session';
      let j = createJWProxy();
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(testNewSessionURL);
    });
    it('should proxy /sessions', function () {
      let incomingUrl = '/sessions';
      let j = createJWProxy();
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(createTestURL('', 'sessions'));
    });
    it('should proxy session commands based off /session', function () {
      let incomingUrl = '/session/foobar/element';
      let j = createJWProxy({
        sessionId: 'barbaz'
      });
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(createTestURL('barbaz', 'element'));
    });
    it('should error session commands based off /session without session id', function () {
      let incomingUrl = '/session/foobar/element';
      let j = createJWProxy();
      (() => {
        j.getUrlForProxy(incomingUrl);
      }).should.throw('session id');
    });
    it('should proxy session commands based off ', function () {
      let incomingUrl = '/session/3d001db2-7987-42a7-975d-8d5d5304083f/timeouts/implicit_wait';
      let j = createJWProxy({
        sessionId: '123'
      });
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(createTestURL('123', 'timeouts/implicit_wait'));
    });
    it('should proxy session commands based off /session as ""', function () {
      let incomingUrl = '';
      let j = createJWProxy();
      (() => {
        j.getUrlForProxy(incomingUrl);
      }).should.throw('session id');
      j = createJWProxy({
        sessionId: '123'
      });
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(createTestSessionURL('123'));
    });
    it('should proxy session commands without /session', function () {
      let incomingUrl = '/element';
      let j = createJWProxy({
        sessionId: 'barbaz'
      });
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(createTestURL('barbaz', 'element'));
    });
    it(`should proxy session commands when '/session' is in the url`, function () {
      let incomingUrl = '/session/82a9b7da-faaf-4a1d-8ef3-5e4fb5812200/cookie/session-something-or-other';
      let j = createJWProxy({
        sessionId: 'barbaz'
      });
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(createTestURL('barbaz', 'cookie/session-something-or-other'));
    });
    it(`should proxy session commands when '/session' is in the url and not base on the original url`, function () {
      let incomingUrl = '/session/82a9b7da-faaf-4a1d-8ef3-5e4fb5812200/cookie/session-something-or-other';
      let j = createJWProxy({
        sessionId: 'barbaz'
      });
      let proxyUrl = j.getUrlForProxy(incomingUrl);
      proxyUrl.should.equal(createTestURL('barbaz', 'cookie/session-something-or-other'));
    });
    it('should error session commands without /session without session id', function () {
      let incomingUrl = '/element';
      let j = createJWProxy();
      (() => {
        j.getUrlForProxy(incomingUrl);
      }).should.throw('session id');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZXNjcmliZSIsInBvcnQiLCJjcmVhdGVUZXN0VVJMIiwidGVzdFN0YXR1c1VSTCIsImNyZWF0ZVRlc3RTZXNzaW9uVVJMIiwidGVzdE5ld1Nlc3Npb25VUkwiLCJQUk9YWV9IT1NUIiwiUFJPWFlfUE9SVCIsImNyZWF0ZVByb3h5VVJMIiwiY3JlYXRlQXBwaXVtVVJMIiwiUFJPWFlfU1RBVFVTX1VSTCIsImNyZWF0ZUpXUHJveHkiLCJvcHRzIiwiSldQcm94eSIsInNlcnZlciIsIlRFU1RfSE9TVCIsImJlZm9yZSIsImdldFRlc3RQb3J0IiwiXyIsIml0IiwiaW5jb21pbmdVcmwiLCJqIiwicHJveHlVcmwiLCJnZXRVcmxGb3JQcm94eSIsInNob3VsZCIsImVxdWFsIiwic2NoZW1lIiwiYmFzZSIsInNlc3Npb25JZCIsInRocm93Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdGVzdC91bml0L2pzb253cC1wcm94eS91cmwuc3BlYy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcblxuaW1wb3J0IHtKV1Byb3h5fSBmcm9tICcuLi8uLi8uLi9saWInO1xuaW1wb3J0IHtnZXRUZXN0UG9ydCwgVEVTVF9IT1NULCBjcmVhdGVBcHBpdW1VUkx9IGZyb20gJy4uLy4uL2hlbHBlcnMnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuZGVzY3JpYmUoJ0pXUHJveHknLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBwb3J0O1xuXG4gIGxldCBjcmVhdGVUZXN0VVJMO1xuICBsZXQgdGVzdFN0YXR1c1VSTDtcbiAgbGV0IGNyZWF0ZVRlc3RTZXNzaW9uVVJMO1xuICBsZXQgdGVzdE5ld1Nlc3Npb25VUkw7XG5cbiAgY29uc3QgUFJPWFlfSE9TVCA9ICcxMjcuMC4wLjInO1xuICBjb25zdCBQUk9YWV9QT1JUID0gNDcyMztcblxuICBjb25zdCBjcmVhdGVQcm94eVVSTCA9IGNyZWF0ZUFwcGl1bVVSTChQUk9YWV9IT1NULCBQUk9YWV9QT1JUKTtcbiAgY29uc3QgUFJPWFlfU1RBVFVTX1VSTCA9IGNyZWF0ZVByb3h5VVJMKCcnLCAnc3RhdHVzJyk7XG5cbiAgZnVuY3Rpb24gY3JlYXRlSldQcm94eShvcHRzID0ge30pIHtcbiAgICByZXR1cm4gbmV3IEpXUHJveHkoe3NlcnZlcjogVEVTVF9IT1NULCBwb3J0LCAuLi5vcHRzfSk7XG4gIH1cblxuICBiZWZvcmUoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIHBvcnQgPSBhd2FpdCBnZXRUZXN0UG9ydCgpO1xuICAgIGNyZWF0ZVRlc3RVUkwgPSBjcmVhdGVBcHBpdW1VUkwoVEVTVF9IT1NULCBwb3J0KTtcbiAgICB0ZXN0U3RhdHVzVVJMID0gY3JlYXRlVGVzdFVSTCgnJywgJ3N0YXR1cycpO1xuICAgIGNyZWF0ZVRlc3RTZXNzaW9uVVJMID0gY3JlYXRlVGVzdFVSTChfLCAnJyk7XG4gICAgdGVzdE5ld1Nlc3Npb25VUkwgPSBjcmVhdGVUZXN0VVJMKCcnLCAnc2Vzc2lvbicpO1xuICB9KTtcblxuICBkZXNjcmliZSgncHJveHlpbmcgZnVsbCB1cmxzJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgdHJhbnNsYXRlIGhvc3QgYW5kIHBvcnQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgaW5jb21pbmdVcmwgPSBQUk9YWV9TVEFUVVNfVVJMO1xuICAgICAgbGV0IGogPSBjcmVhdGVKV1Byb3h5KCk7XG4gICAgICBsZXQgcHJveHlVcmwgPSBqLmdldFVybEZvclByb3h5KGluY29taW5nVXJsKTtcbiAgICAgIHByb3h5VXJsLnNob3VsZC5lcXVhbCh0ZXN0U3RhdHVzVVJMKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRyYW5zbGF0ZSB0aGUgc2NoZW1lJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGluY29taW5nVXJsID0gUFJPWFlfU1RBVFVTX1VSTDtcbiAgICAgIGxldCBqID0gY3JlYXRlSldQcm94eSh7c2NoZW1lOiAnSFRUUFMnfSk7XG4gICAgICBsZXQgcHJveHlVcmwgPSBqLmdldFVybEZvclByb3h5KGluY29taW5nVXJsKTtcbiAgICAgIHByb3h5VXJsLnNob3VsZC5lcXVhbChjcmVhdGVBcHBpdW1VUkwoYGh0dHBzOi8vJHtURVNUX0hPU1R9YCwgcG9ydCwgJycsICdzdGF0dXMnKSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0cmFuc2xhdGUgdGhlIGJhc2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgaW5jb21pbmdVcmwgPSBQUk9YWV9TVEFUVVNfVVJMO1xuICAgICAgbGV0IGogPSBjcmVhdGVKV1Byb3h5KHtiYXNlOiAnJ30pO1xuICAgICAgbGV0IHByb3h5VXJsID0gai5nZXRVcmxGb3JQcm94eShpbmNvbWluZ1VybCk7XG4gICAgICBwcm94eVVybC5zaG91bGQuZXF1YWwodGVzdFN0YXR1c1VSTCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0cmFuc2xhdGUgdGhlIHNlc3Npb24gaWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgaW5jb21pbmdVcmwgPSBjcmVhdGVQcm94eVVSTCgnZm9vYmFyJywgJ2VsZW1lbnQnKTtcbiAgICAgIGxldCBqID0gY3JlYXRlSldQcm94eSh7c2Vzc2lvbklkOiAnYmFyYmF6J30pO1xuICAgICAgbGV0IHByb3h5VXJsID0gai5nZXRVcmxGb3JQcm94eShpbmNvbWluZ1VybCk7XG4gICAgICBwcm94eVVybC5zaG91bGQuZXF1YWwoY3JlYXRlVGVzdFVSTCgnYmFyYmF6JywgJ2VsZW1lbnQnKSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBlcnJvciB3aGVuIHRyYW5zbGF0aW5nIHNlc3Npb24gY29tbWFuZHMgd2l0aG91dCBzZXNzaW9uIGlkJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGluY29taW5nVXJsID0gY3JlYXRlUHJveHlVUkwoJ2Zvb2JhcicsICdlbGVtZW50Jyk7XG4gICAgICBsZXQgaiA9IGNyZWF0ZUpXUHJveHkoKTtcbiAgICAgICgoKSA9PiB7XG4gICAgICAgIGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpO1xuICAgICAgfSkuc2hvdWxkLnRocm93KCdzZXNzaW9uIGlkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwcm94eWluZyBwYXJ0aWFsIHVybHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBwcm94eSAvc3RhdHVzJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGluY29taW5nVXJsID0gJy9zdGF0dXMnO1xuICAgICAgbGV0IGogPSBjcmVhdGVKV1Byb3h5KCk7XG4gICAgICBsZXQgcHJveHlVcmwgPSBqLmdldFVybEZvclByb3h5KGluY29taW5nVXJsKTtcbiAgICAgIHByb3h5VXJsLnNob3VsZC5lcXVhbCh0ZXN0U3RhdHVzVVJMKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHByb3h5IC9zZXNzaW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGluY29taW5nVXJsID0gJy9zZXNzaW9uJztcbiAgICAgIGxldCBqID0gY3JlYXRlSldQcm94eSgpO1xuICAgICAgbGV0IHByb3h5VXJsID0gai5nZXRVcmxGb3JQcm94eShpbmNvbWluZ1VybCk7XG4gICAgICBwcm94eVVybC5zaG91bGQuZXF1YWwodGVzdE5ld1Nlc3Npb25VUkwpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgcHJveHkgL3Nlc3Npb25zJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGluY29taW5nVXJsID0gJy9zZXNzaW9ucyc7XG4gICAgICBsZXQgaiA9IGNyZWF0ZUpXUHJveHkoKTtcbiAgICAgIGxldCBwcm94eVVybCA9IGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpO1xuICAgICAgcHJveHlVcmwuc2hvdWxkLmVxdWFsKGNyZWF0ZVRlc3RVUkwoJycsICdzZXNzaW9ucycpKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHByb3h5IHNlc3Npb24gY29tbWFuZHMgYmFzZWQgb2ZmIC9zZXNzaW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGluY29taW5nVXJsID0gJy9zZXNzaW9uL2Zvb2Jhci9lbGVtZW50JztcbiAgICAgIGxldCBqID0gY3JlYXRlSldQcm94eSh7c2Vzc2lvbklkOiAnYmFyYmF6J30pO1xuICAgICAgbGV0IHByb3h5VXJsID0gai5nZXRVcmxGb3JQcm94eShpbmNvbWluZ1VybCk7XG4gICAgICBwcm94eVVybC5zaG91bGQuZXF1YWwoY3JlYXRlVGVzdFVSTCgnYmFyYmF6JywgJ2VsZW1lbnQnKSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBlcnJvciBzZXNzaW9uIGNvbW1hbmRzIGJhc2VkIG9mZiAvc2Vzc2lvbiB3aXRob3V0IHNlc3Npb24gaWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgaW5jb21pbmdVcmwgPSAnL3Nlc3Npb24vZm9vYmFyL2VsZW1lbnQnO1xuICAgICAgbGV0IGogPSBjcmVhdGVKV1Byb3h5KCk7XG4gICAgICAoKCkgPT4ge1xuICAgICAgICBqLmdldFVybEZvclByb3h5KGluY29taW5nVXJsKTtcbiAgICAgIH0pLnNob3VsZC50aHJvdygnc2Vzc2lvbiBpZCcpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgcHJveHkgc2Vzc2lvbiBjb21tYW5kcyBiYXNlZCBvZmYgJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGluY29taW5nVXJsID0gJy9zZXNzaW9uLzNkMDAxZGIyLTc5ODctNDJhNy05NzVkLThkNWQ1MzA0MDgzZi90aW1lb3V0cy9pbXBsaWNpdF93YWl0JztcbiAgICAgIGxldCBqID0gY3JlYXRlSldQcm94eSh7c2Vzc2lvbklkOiAnMTIzJ30pO1xuICAgICAgbGV0IHByb3h5VXJsID0gai5nZXRVcmxGb3JQcm94eShpbmNvbWluZ1VybCk7XG4gICAgICBwcm94eVVybC5zaG91bGQuZXF1YWwoY3JlYXRlVGVzdFVSTCgnMTIzJywgJ3RpbWVvdXRzL2ltcGxpY2l0X3dhaXQnKSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBwcm94eSBzZXNzaW9uIGNvbW1hbmRzIGJhc2VkIG9mZiAvc2Vzc2lvbiBhcyBcIlwiJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGluY29taW5nVXJsID0gJyc7XG4gICAgICBsZXQgaiA9IGNyZWF0ZUpXUHJveHkoKTtcbiAgICAgICgoKSA9PiB7XG4gICAgICAgIGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpO1xuICAgICAgfSkuc2hvdWxkLnRocm93KCdzZXNzaW9uIGlkJyk7XG4gICAgICBqID0gY3JlYXRlSldQcm94eSh7c2Vzc2lvbklkOiAnMTIzJ30pO1xuICAgICAgbGV0IHByb3h5VXJsID0gai5nZXRVcmxGb3JQcm94eShpbmNvbWluZ1VybCk7XG4gICAgICBwcm94eVVybC5zaG91bGQuZXF1YWwoY3JlYXRlVGVzdFNlc3Npb25VUkwoJzEyMycpKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHByb3h5IHNlc3Npb24gY29tbWFuZHMgd2l0aG91dCAvc2Vzc2lvbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBpbmNvbWluZ1VybCA9ICcvZWxlbWVudCc7XG4gICAgICBsZXQgaiA9IGNyZWF0ZUpXUHJveHkoe3Nlc3Npb25JZDogJ2JhcmJheid9KTtcbiAgICAgIGxldCBwcm94eVVybCA9IGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpO1xuICAgICAgcHJveHlVcmwuc2hvdWxkLmVxdWFsKGNyZWF0ZVRlc3RVUkwoJ2JhcmJheicsICdlbGVtZW50JykpO1xuICAgIH0pO1xuICAgIGl0KGBzaG91bGQgcHJveHkgc2Vzc2lvbiBjb21tYW5kcyB3aGVuICcvc2Vzc2lvbicgaXMgaW4gdGhlIHVybGAsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBpbmNvbWluZ1VybCA9XG4gICAgICAgICcvc2Vzc2lvbi84MmE5YjdkYS1mYWFmLTRhMWQtOGVmMy01ZTRmYjU4MTIyMDAvY29va2llL3Nlc3Npb24tc29tZXRoaW5nLW9yLW90aGVyJztcbiAgICAgIGxldCBqID0gY3JlYXRlSldQcm94eSh7c2Vzc2lvbklkOiAnYmFyYmF6J30pO1xuICAgICAgbGV0IHByb3h5VXJsID0gai5nZXRVcmxGb3JQcm94eShpbmNvbWluZ1VybCk7XG4gICAgICBwcm94eVVybC5zaG91bGQuZXF1YWwoY3JlYXRlVGVzdFVSTCgnYmFyYmF6JywgJ2Nvb2tpZS9zZXNzaW9uLXNvbWV0aGluZy1vci1vdGhlcicpKTtcbiAgICB9KTtcbiAgICBpdChgc2hvdWxkIHByb3h5IHNlc3Npb24gY29tbWFuZHMgd2hlbiAnL3Nlc3Npb24nIGlzIGluIHRoZSB1cmwgYW5kIG5vdCBiYXNlIG9uIHRoZSBvcmlnaW5hbCB1cmxgLCBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgaW5jb21pbmdVcmwgPVxuICAgICAgICAnL3Nlc3Npb24vODJhOWI3ZGEtZmFhZi00YTFkLThlZjMtNWU0ZmI1ODEyMjAwL2Nvb2tpZS9zZXNzaW9uLXNvbWV0aGluZy1vci1vdGhlcic7XG4gICAgICBsZXQgaiA9IGNyZWF0ZUpXUHJveHkoe3Nlc3Npb25JZDogJ2JhcmJheid9KTtcbiAgICAgIGxldCBwcm94eVVybCA9IGouZ2V0VXJsRm9yUHJveHkoaW5jb21pbmdVcmwpO1xuICAgICAgcHJveHlVcmwuc2hvdWxkLmVxdWFsKGNyZWF0ZVRlc3RVUkwoJ2JhcmJheicsICdjb29raWUvc2Vzc2lvbi1zb21ldGhpbmctb3Itb3RoZXInKSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBlcnJvciBzZXNzaW9uIGNvbW1hbmRzIHdpdGhvdXQgL3Nlc3Npb24gd2l0aG91dCBzZXNzaW9uIGlkJywgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGluY29taW5nVXJsID0gJy9lbGVtZW50JztcbiAgICAgIGxldCBqID0gY3JlYXRlSldQcm94eSgpO1xuICAgICAgKCgpID0+IHtcbiAgICAgICAgai5nZXRVcmxGb3JQcm94eShpbmNvbWluZ1VybCk7XG4gICAgICB9KS5zaG91bGQudGhyb3coJ3Nlc3Npb24gaWQnKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FB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