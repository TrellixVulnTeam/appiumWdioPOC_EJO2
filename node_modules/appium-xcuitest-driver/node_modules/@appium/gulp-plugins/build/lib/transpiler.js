'use strict';

require("source-map-support/register");

const babel = require('gulp-babel');

const rename = require('gulp-rename');

const streamCombiner = require('./stream-combiner');

const path = require('path');

const sourcemaps = require('./sourcemaps');

const BABEL_OPTS = {
  configFile: path.resolve(__dirname, '..', '.babelrc')
};

const renameEsX = function () {
  return rename(function renameEs(path) {
    path.basename = path.basename.replace(/\.es[67]$/, '');
  });
};

module.exports = function transpiler(opts = {}) {
  const {
    sourceMapInit,
    sourceMapHeader,
    sourceMapWrite
  } = sourcemaps(opts.sourceMapOpts);

  this.stream = function stream() {
    return streamCombiner(function combine(source) {
      return source.pipe(sourceMapInit).pipe(babel(Object.assign({}, BABEL_OPTS, opts.babelOpts))).pipe(sourceMapHeader).pipe(renameEsX()).pipe(sourceMapWrite);
    });
  };
};require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL3RyYW5zcGlsZXIuanMiLCJuYW1lcyI6WyJiYWJlbCIsInJlcXVpcmUiLCJyZW5hbWUiLCJzdHJlYW1Db21iaW5lciIsInBhdGgiLCJzb3VyY2VtYXBzIiwiQkFCRUxfT1BUUyIsImNvbmZpZ0ZpbGUiLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwicmVuYW1lRXNYIiwicmVuYW1lRXMiLCJiYXNlbmFtZSIsInJlcGxhY2UiLCJtb2R1bGUiLCJleHBvcnRzIiwidHJhbnNwaWxlciIsIm9wdHMiLCJzb3VyY2VNYXBJbml0Iiwic291cmNlTWFwSGVhZGVyIiwic291cmNlTWFwV3JpdGUiLCJzb3VyY2VNYXBPcHRzIiwic3RyZWFtIiwiY29tYmluZSIsInNvdXJjZSIsInBpcGUiLCJPYmplY3QiLCJhc3NpZ24iLCJiYWJlbE9wdHMiXSwic291cmNlUm9vdCI6Ii4uLy4uIiwic291cmNlcyI6WyJsaWIvdHJhbnNwaWxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IGJhYmVsID0gcmVxdWlyZSgnZ3VscC1iYWJlbCcpO1xuY29uc3QgcmVuYW1lID0gcmVxdWlyZSgnZ3VscC1yZW5hbWUnKTtcbmNvbnN0IHN0cmVhbUNvbWJpbmVyID0gcmVxdWlyZSgnLi9zdHJlYW0tY29tYmluZXInKTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5jb25zdCBzb3VyY2VtYXBzID0gcmVxdWlyZSgnLi9zb3VyY2VtYXBzJyk7XG5cbmNvbnN0IEJBQkVMX09QVFMgPSB7XG4gIGNvbmZpZ0ZpbGU6IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLicsICcuYmFiZWxyYycpLFxufTtcblxuY29uc3QgcmVuYW1lRXNYID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gcmVuYW1lKGZ1bmN0aW9uIHJlbmFtZUVzKHBhdGgpIHtcbiAgICBwYXRoLmJhc2VuYW1lID0gcGF0aC5iYXNlbmFtZS5yZXBsYWNlKC9cXC5lc1s2N10kLywgJycpO1xuICB9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gdHJhbnNwaWxlcihvcHRzID0ge30pIHtcbiAgY29uc3Qge3NvdXJjZU1hcEluaXQsIHNvdXJjZU1hcEhlYWRlciwgc291cmNlTWFwV3JpdGV9ID0gc291cmNlbWFwcyhvcHRzLnNvdXJjZU1hcE9wdHMpO1xuXG4gIHRoaXMuc3RyZWFtID0gZnVuY3Rpb24gc3RyZWFtKCkge1xuICAgIHJldHVybiBzdHJlYW1Db21iaW5lcihmdW5jdGlvbiBjb21iaW5lKHNvdXJjZSkge1xuICAgICAgcmV0dXJuIHNvdXJjZVxuICAgICAgICAucGlwZShzb3VyY2VNYXBJbml0KVxuICAgICAgICAucGlwZShiYWJlbChPYmplY3QuYXNzaWduKHt9LCBCQUJFTF9PUFRTLCBvcHRzLmJhYmVsT3B0cykpKVxuICAgICAgICAucGlwZShzb3VyY2VNYXBIZWFkZXIpXG4gICAgICAgIC5waXBlKHJlbmFtZUVzWCgpKVxuICAgICAgICAucGlwZShzb3VyY2VNYXBXcml0ZSk7XG4gICAgfSk7XG4gIH07XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztBQUVBLE1BQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLFlBQUQsQ0FBckI7O0FBQ0EsTUFBTUMsTUFBTSxHQUFHRCxPQUFPLENBQUMsYUFBRCxDQUF0Qjs7QUFDQSxNQUFNRSxjQUFjLEdBQUdGLE9BQU8sQ0FBQyxtQkFBRCxDQUE5Qjs7QUFDQSxNQUFNRyxJQUFJLEdBQUdILE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1JLFVBQVUsR0FBR0osT0FBTyxDQUFDLGNBQUQsQ0FBMUI7O0FBRUEsTUFBTUssVUFBVSxHQUFHO0VBQ2pCQyxVQUFVLEVBQUVILElBQUksQ0FBQ0ksT0FBTCxDQUFhQyxTQUFiLEVBQXdCLElBQXhCLEVBQThCLFVBQTlCO0FBREssQ0FBbkI7O0FBSUEsTUFBTUMsU0FBUyxHQUFHLFlBQVk7RUFDNUIsT0FBT1IsTUFBTSxDQUFDLFNBQVNTLFFBQVQsQ0FBa0JQLElBQWxCLEVBQXdCO0lBQ3BDQSxJQUFJLENBQUNRLFFBQUwsR0FBZ0JSLElBQUksQ0FBQ1EsUUFBTCxDQUFjQyxPQUFkLENBQXNCLFdBQXRCLEVBQW1DLEVBQW5DLENBQWhCO0VBQ0QsQ0FGWSxDQUFiO0FBR0QsQ0FKRDs7QUFNQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCLFNBQVNDLFVBQVQsQ0FBb0JDLElBQUksR0FBRyxFQUEzQixFQUErQjtFQUM5QyxNQUFNO0lBQUNDLGFBQUQ7SUFBZ0JDLGVBQWhCO0lBQWlDQztFQUFqQyxJQUFtRGYsVUFBVSxDQUFDWSxJQUFJLENBQUNJLGFBQU4sQ0FBbkU7O0VBRUEsS0FBS0MsTUFBTCxHQUFjLFNBQVNBLE1BQVQsR0FBa0I7SUFDOUIsT0FBT25CLGNBQWMsQ0FBQyxTQUFTb0IsT0FBVCxDQUFpQkMsTUFBakIsRUFBeUI7TUFDN0MsT0FBT0EsTUFBTSxDQUNWQyxJQURJLENBQ0NQLGFBREQsRUFFSk8sSUFGSSxDQUVDekIsS0FBSyxDQUFDMEIsTUFBTSxDQUFDQyxNQUFQLENBQWMsRUFBZCxFQUFrQnJCLFVBQWxCLEVBQThCVyxJQUFJLENBQUNXLFNBQW5DLENBQUQsQ0FGTixFQUdKSCxJQUhJLENBR0NOLGVBSEQsRUFJSk0sSUFKSSxDQUlDZixTQUFTLEVBSlYsRUFLSmUsSUFMSSxDQUtDTCxjQUxELENBQVA7SUFNRCxDQVBvQixDQUFyQjtFQVFELENBVEQ7QUFVRCxDQWJEIn0=
